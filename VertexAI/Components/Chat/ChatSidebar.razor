@* 侧边栏组件 - 对话历史列表 *@

<aside class="@(IsOpen ? "translate-x-0" : "-translate-x-full md:w-0 md:border-r-0")
              absolute md:static inset-y-0 left-0 z-40 w-64 md:w-64 flex-shrink-0
              bg-amber-100 border-r border-amber-200 flex flex-col
              transition-all duration-300 ease-in-out">
    <div class="p-3 border-b border-amber-200 flex items-center justify-between">
        <span class="font-bold text-amber-800">对话历史</span>
        <div class="flex items-center gap-1">
            <button @onclick="OnNewConversation" class="p-1 hover:bg-amber-200 rounded" title="新对话">
                <svg class="w-5 h-5 text-amber-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
            </button>
            <button @onclick="OnToggle" class="md:hidden p-1 hover:bg-amber-200 rounded" title="关闭">
                <svg class="w-5 h-5 text-amber-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto">
        @foreach (var conv in Conversations)
        {
            <div class="group flex items-center hover:bg-amber-200 transition-colors @(CurrentConversationId == conv.Id ? "bg-amber-200" : "")">
                <button @onclick="() => OnSelectConversation.InvokeAsync(conv.Id)"
                        class="flex-1 text-left px-3 py-2 text-sm truncate">
                    @(conv.Title ?? "新对话")
                </button>
                <button @onclick="() => OnDeleteConversation.InvokeAsync(conv.Id)" @onclick:stopPropagation
                        class="hidden group-hover:block px-2 py-1 text-amber-600 hover:text-red-600"
                        title="删除对话">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            </div>
        }
    </div>

    <div class="p-3 border-t border-amber-200">
        <button @onclick="OnSignOut" class="w-full text-left text-sm text-amber-700 hover:text-amber-900 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
            </svg>
            <span class="truncate">退出 (@UserEmail)</span>
        </button>
    </div>
</aside>

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public List<ConversationItem> Conversations { get; set; } = [];
    [Parameter] public Guid? CurrentConversationId { get; set; }
    [Parameter] public string UserEmail { get; set; } = "";
    [Parameter] public EventCallback OnToggle { get; set; }
    [Parameter] public EventCallback OnNewConversation { get; set; }
    [Parameter] public EventCallback<Guid> OnSelectConversation { get; set; }
    [Parameter] public EventCallback<Guid> OnDeleteConversation { get; set; }
    [Parameter] public EventCallback OnSignOut { get; set; }
}

