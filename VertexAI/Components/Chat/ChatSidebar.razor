@* 侧边栏组件 - 对话历史列表 *@

<aside class="@(IsOpen ? "translate-x-0 w-64" : "-translate-x-full w-0 overflow-hidden")
              absolute md:static inset-y-0 left-0 z-40 flex-shrink-0
              bg-white/80 backdrop-blur-xl border-r border-slate-100 flex flex-col
              transition-all duration-300 ease-in-out shadow-xl md:shadow-none">
    <div class="p-4 border-b border-slate-100 flex items-center justify-between">
        <span class="font-bold text-slate-700">对话历史</span>
        <div class="flex items-center gap-1">
            <button @onclick="OnNewConversation" class="p-1.5 hover:bg-slate-100 rounded-lg text-slate-500 hover:text-sky-500 transition-colors" title="新对话">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
            </button>
            <button @onclick="OnToggle" class="md:hidden p-1.5 hover:bg-slate-100 rounded-lg text-slate-500" title="关闭">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto p-2">
        @foreach (var conv in Conversations)
        {
            <div class="group flex items-center rounded-xl mb-1 transition-all @(CurrentConversationId == conv.Id ? "bg-white shadow-sm ring-1 ring-sky-200" : "hover:bg-slate-50")">
                <button @onclick="() => OnSelectConversation.InvokeAsync(conv.Id)"
                        class="flex-1 text-left px-3 py-2.5 text-sm truncate @(CurrentConversationId == conv.Id ? "text-sky-600 font-medium" : "text-slate-600")">
                    @(conv.Title ?? "新对话")
                </button>
                <button @onclick="() => OnDeleteConversation.InvokeAsync(conv.Id)" @onclick:stopPropagation
                        class="hidden group-hover:block px-2 py-1 text-slate-400 hover:text-red-500 transition-colors"
                        title="删除对话">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            </div>
        }
    </div>

    <div class="p-4 border-t border-slate-100">
        <button @onclick="OnSignOut" class="w-full text-left text-sm text-slate-500 hover:text-slate-700 flex items-center gap-2 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
            </svg>
            <span class="truncate">退出 (@UserEmail)</span>
        </button>
    </div>
</aside>

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public List<ConversationItem> Conversations { get; set; } = [];
    [Parameter] public Guid? CurrentConversationId { get; set; }
    [Parameter] public string UserEmail { get; set; } = "";
    [Parameter] public EventCallback OnToggle { get; set; }
    [Parameter] public EventCallback OnNewConversation { get; set; }
    [Parameter] public EventCallback<Guid> OnSelectConversation { get; set; }
    [Parameter] public EventCallback<Guid> OnDeleteConversation { get; set; }
    [Parameter] public EventCallback OnSignOut { get; set; }
}

