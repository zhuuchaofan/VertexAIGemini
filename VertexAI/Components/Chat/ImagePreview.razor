@* 图片预览组件 - 显示待发送的图片缩略图 *@

@if (Images.Count > 0)
{
    <div class="flex flex-wrap gap-2 p-2 bg-slate-50 rounded-xl mb-2 animate-slideIn">
        @foreach (var image in Images)
        {
            <div class="relative group">
                @* 图片容器 *@
                <div class="relative w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden border border-slate-200 shadow-sm bg-slate-100">
                    @* 骨架屏加载态 *@
                    <div class="absolute inset-0 skeleton-loading" id="skeleton-@image.GetHashCode()"></div>

                    @* 实际图片 *@
                    <img src="@image.DataUrl"
                         alt="@(image.FileName ?? "预览图片")"
                         class="w-full h-full object-cover transition-opacity duration-300"
                         @onload="@(() => HideSkeleton(image.GetHashCode()))"
                         @onerror="@(() => ShowError(image.GetHashCode()))" />
                </div>

                @* 删除按钮 - 移动端始终可见，桌面端悬停显示 *@
                <button type="button"
                        @onclick="() => OnRemove.InvokeAsync(image)"
                        class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center
                               sm:opacity-0 sm:group-hover:opacity-100 transition-all shadow-md hover:bg-red-600 hover:scale-110 active:scale-95">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        }
    </div>
}

<style>
    .animate-slideIn {
        animation: slideIn 0.25s ease-out;
    }
    @@keyframes slideIn {
        from { opacity: 0; transform: translateY(-8px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .skeleton-loading {
        background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
    }
    @@keyframes shimmer {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }
</style>

@code {
    [Parameter] public List<ImageAttachment> Images { get; set; } = new();
    [Parameter] public EventCallback<ImageAttachment> OnRemove { get; set; }

    private void HideSkeleton(int hash)
    {
        // 骨架屏会被图片覆盖，无需额外处理
    }

    private void ShowError(int hash)
    {
        // 图片加载失败时可以显示错误图标
    }
}

